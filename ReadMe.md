# Uchet Bot

**Uchet Bot** — это Telegram-бот для автоматизации учёта инструментов, материалов, сотрудников и документооборота на строительных и сервисных объектах. Проект включает backend на Python (FastAPI, aiogram), административную панель (Flask-Admin) и интеграцию с PostgreSQL.

---

## Основные возможности

- Учёт и передача инструментов между сотрудниками
- Учёт остатков и заказ материалов
- Учёт и загрузка документов (PDF, фото)
- Массовые уведомления и отчёты
- Гибкая система ролей и прав доступа
- Многоязычный интерфейс (RU, UZ, TG)
- Админ-панель для управления пользователями, объектами, логами и документами

---

## Быстрый старт

### 1. Клонирование репозитория

```bash
git clone <repo_url>
cd uchet_bot
```

---

## Переменные окружения (`.env`)

Создайте файл `.env` в корне проекта и укажите переменные:

```env
BOT_TOKEN=токен_вашего_бота
ROOT_ADMIN_IDS=[123456789,987654321]  # Список Telegram ID админов

TELEGRAM_GROUP_ID_VIDEO_OTCHET=-100...
TELEGRAM_GROUP_ID_MATERIAL=-100...
TELEGRAM_GROUP_ID_CHEKS=-100...
TELEGRAM_GROUP_ID_OBJECT_PHOTO=-100...
TELEGRAM_GROUP_ID_MATERIAL_ORDER=-100...
TELEGRAM_GROUP_ID_TRANSFER_TOOL=-100...
TELEGRAM_GROUP_ID_FOREMAN_REPORTS=-100...
TELEGRAM_GROUP_ID_USER_DOCUMENTS=-100...

DB_URL=postgresql+asyncpg://user:pass@db:5432/uchet
SYNC_DB_URL=postgresql://user:pass@db:5432/uchet
```

**Описание переменных:**
- `BOT_TOKEN` — токен Telegram-бота.
- `ROOT_ADMIN_IDS` — список Telegram ID главных админов (через запятую, в квадратных скобках).
- `TELEGRAM_GROUP_ID_*` — ID групп/каналов для хранения отчётов, чеков, документов и т.д.
- `DB_URL` и `SYNC_DB_URL` — строки подключения к PostgreSQL (используйте одинаковые креды для асинхронного и синхронного доступа).

---

## Работа с миграциями

Для управления схемой БД используется Alembic.

**Создать новую миграцию:**
```bash
alembic revision --autogenerate -m "описание изменений"
```

**Применить миграции:**
```bash
alembic upgrade head
```

**Папка миграций:**  
`app/migration/versions/`

**Рекомендации:**
- Не редактируйте структуру БД вручную, используйте только миграции.
- Перед применением миграций убедитесь, что контейнер с базой данных запущен.

---

## Запуск через Docker
**Запуск:**
```bash
docker compose up --build
```

---

## Рекомендации по работе

- Перед запуском убедитесь, что все переменные окружения корректно заполнены.
- Для production используйте отдельные группы/каналы Telegram для хранения документов и отчётов.
- Регулярно делайте бэкапы базы данных.
- Для обновления схемы БД используйте Alembic и не редактируйте структуру вручную.
- Права доступа сотрудников регулируются через поле `can_use_bot` и роль пользователя.
- Для интеграции новых функций используйте архитектуру роутеров и DAO.
- Для тестирования используйте отдельную базу данных и отдельные Telegram-группы.
---

## Контакты и поддержка

- Вопросы и предложения: @Ebezin
---
